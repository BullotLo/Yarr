########################################
#  This file was generated by hdlmake  #
#  http://ohwr.org/projects/hdl-make/  #
########################################

PROJECT := yarr_spec.xise
ISE_CRAP := *.b yarr_summary.html *.tcl yarr.bld yarr.cmd_log *.drc yarr.lso *.ncd yarr.ngc yarr.ngd yarr.ngr yarr.pad yarr.par yarr.pcf yarr.prj yarr.ptwx yarr.stx yarr.syr yarr.twr yarr.twx yarr.gise $(PROJECT).gise yarr.bgn yarr.unroutes yarr.ut yarr.xpi yarr.xst yarr_bitgen.xwbt yarr_envsettings.html yarr_guide.ncd yarr_map.map yarr_map.mrp yarr_map.ncd yarr_map.ngm yarr_map.xrpt yarr_ngdbuild.xrpt yarr_pad.csv yarr_pad.txt yarr_par.xrpt yarr_summary.xml yarr_usage.xml yarr_xst.xrpt usage_statistics_webtalk.html par_usage_statistics.html webtalk.log webtalk_pn.xml run.tcl

#target for performing local synthesis
local: syn_pre_cmd check_tool generate_tcl synthesis syn_post_cmd

generate_tcl:
		echo "project open $(PROJECT)" > run.tcl
		echo "process run {Synthesize - XST}" >> run.tcl
		echo "process run {Translate}" >> run.tcl
		echo "process run {Map}" >> run.tcl
		echo "process run {Place & Route}" >> run.tcl
		echo "process run {Generate Programming File}" >> run.tcl

synthesis:
		/opt/Xilinx/14.7/ISE_DS/ISE/bin/lin64/xtclsh run.tcl

check_tool:
		

syn_post_cmd:
		

syn_pre_cmd:
		

#target for cleaning all intermediate stuff
clean:
		rm -f $(ISE_CRAP)
		rm -rf xst xlnx_auto_*_xdb iseconfig _xmsgs _ngo

#target for cleaning final files
mrproper:
		rm -f *.bit *.bin *.mcs

.PHONY: mrproper clean syn_pre_cmd syn_post_cmd synthesis local check_tool

USER:=$(HDLMAKE_RSYNTH_USER)# take the value from the environment
SERVER:=$(HDLMAKE_RSYNTH_SERVER)# take the value from the environment
ISE_PATH:=$(HDLMAKE_RSYNTH_ISE_PATH)
R_NAME:=theim/yarr_spec
PORT:=22

__test_for_remote_synthesis_variables:
ifeq (x$(USER),x)
	@echo "Remote synthesis user is not set. You can set it by editing variable USER in the makefile or setting env. variable HDLMAKE_RSYNTH_USER." && false
endif
ifeq (x$(SERVER),x)
	@echo "Remote synthesis server is not set. You can set it by editing variable SERVER in the makefile or setting env. variable HDLMAKE_RSYNTH_SERVER." && false
endif
ifeq (x$(ISE_PATH),x)
	@echo "Remote synthesis server is not set. You can set it by editing variable ISE_PATH in the makefile or setting env. variable HDLMAKE_RSYNTH_ISE_PATH." && false
endif

CWD := $(shell pwd)

FILES := ../../../ip-cores/spartan6/l2p_fifo.ngc \
../../../rtl/i2c-master/i2c_master_bit_ctrl.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/l2p_ser.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/gn4124_core.vhd \
../../../rtl/spartan6/ddr3-core/ddr3_ctrl_wrapper_pkg.vhd \
../../../ip-cores/spartan6/ila_icon.ngc \
../../../rtl/spartan6/gn4124-core/dma_controller.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/mcb_soft_calibration.vhd \
run.tcl \
../../../ip-cores/spartan6/fifo_32x512.ngc \
../../../rtl/common/simple_counter.vhd \
../../../rtl/spartan6/gn4124-core/l2p_dma_master.vhd \
../../../rtl/spartan6/gn4124-core/dma_controller_wb_slave.vhd \
../../../rtl/tx-core/tx_channel.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_bram.vhd \
../../../ip-cores/spartan6/rx_bridge_fifo.ngc \
../../../rtl/spartan6/gn4124-core/spartan6/serdes_n_to_1_s2_diff.vhd \
../../../rtl/tx-core/serial_port.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_wrapper.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/ddr3_ctrl_spec_bank3_32b_32b.vhd \
../../../rtl/rx-core/data_alignment.vhd \
../../../rtl/common/wshexp_core_pkg.vhd \
../../../rtl/fe65p2_addon.vhd \
../../../ip-cores/spartan6/rx_bridge_ctrl_fifo.vhd \
../../../rtl/spartan6/ddr3-core/ddr3_ctrl_pkg.vhd \
../../../rtl/i2c-master/i2c_master_wb_top.vhd \
../../../ip-cores/spartan6/rx_bridge_fifo.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/mcb_soft_calibration_top.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/mcb_raw_wrapper.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/iodrp_mcb_controller.vhd \
../../../ip-cores/spartan6/rx_bridge_ctrl_fifo.ngc \
yarr_octa_fei4_revA.ucf \
../../../rtl/common/synchronizer.vhd \
../../../ip-cores/spartan6/clk_gen.vhd \
../../../rtl/common/wb_addr_decoder.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/serdes_n_to_1_s2_se.vhd \
../../../rtl/common/dummy_ctrl_regs.vhd \
../../../rtl/common/common_pkg.vhd \
../../../rtl/spartan6/ddr3-core/ddr3_ctrl_wb.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/serdes_1_to_n_data_s2_se.vhd \
../../../rtl/rx-core/fei4_rx_channel.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_disp.vhd \
../../../ip-cores/spartan6/rx_channel_fifo.ngc \
../../../rtl/spartan6/gn4124-core/wbmaster32.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/memc3_wrapper.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_top.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/memc3_infrastructure.vhd \
../../../ip-cores/spartan6/ila.ngc \
../../../ip-cores/spartan6/l2p_fifo.vhd \
../../../ip-cores/spartan6/ila.vhd \
../../../rtl/app_package.vhd \
../../../ip-cores/spartan6/fifo_64x512.vhd \
../../../rtl/common/generic_async_fifo_wrapper.vhd \
../../../rtl/tx-core/wb_tx_core.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_lut.vhd \
../../../ip-cores/spartan6/rx_channel_fifo.vhd \
../../../rtl/rx-core/wb_rx_core.vhd \
../top_yarr_spec.vhd \
../../../rtl/spartan6/gn4124-core/l2p_arbiter.vhd \
../../../rtl/common/dummy_stat_regs.vhd \
../../../rtl/spartan6/ddr3-core/ip_cores/ddr3_ctrl_spec_bank3_32b_32b/user_design/rtl/iodrp_controller.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/pulse_sync_rtl.vhd \
../../../rtl/spartan6/ddr3-core/ddr3_ctrl.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_pkg.vhd \
../../../rtl/spartan6/ddr3-core/ddr3_ctrl_wrapper.vhd \
../../../rtl/common/bcf_bram32.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/gn4124_core_pkg.vhd \
../../../rtl/spartan6/gn4124-core/p2l_dma_master.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/serdes_1_to_n_clk_pll_s2_diff.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_rtl.vhd \
../../../rtl/i2c-master/i2c_master_byte_ctrl.vhd \
../../../rtl/i2c-master/i2c_master_registers.vhd \
../../../rtl/rx-core/wb_rx_bridge.vhd \
../../../rtl/app.vhd \
../../../rtl/spartan6/gn4124-core/spartan6/p2l_des.vhd \
../../../ip-cores/spartan6/fifo_32x512.vhd \
../../../rtl/common/delay_line.vhd \
../../../rtl/rx-core/cdr_serdes.vhd \
../../../rtl/rx-core/decode_8b10b/decode_8b10b_lut_base.vhd \
../../../ip-cores/spartan6/ila_icon.vhd \
yarr_spec.xise \
../../../rtl/tx-core/trigger_unit.vhd \
../../../rtl/trigger-logic/wb_trigger_logic.vhd \
../../../rtl/common/k_bram.vhd \
../../../ip-cores/spartan6/fifo_64x512.ngc \
../../../rtl/trigger-logic/eudet_tlu.vhd \
../../../rtl/spartan6/gn4124-core/p2l_decode32.vhd \
../../../rtl/common/rr_arbiter.vhd

#target for running synthesis in the remote location
remote: __test_for_remote_synthesis_variables generate_tcl __send __do_synthesis
__send_back: __do_synthesis
__do_synthesis: __send
__send: __test_for_remote_synthesis_variables

__send:
		ssh $(USER)@$(SERVER) 'mkdir -p $(R_NAME)'
		rsync -e 'ssh -p $(PORT)' -Ravl $(foreach file, $(FILES), $(shell readlink -f $(file))) $(USER)@$(SERVER):$(R_NAME)

__do_synthesis:
ifeq (x$(HDLMAKE_RSYNTH_USE_SCREEN), x1)
		ssh -t $(USER)@$(SERVER) 'screen bash -c "cd $(R_NAME)$(CWD) && $(HDLMAKE_RSYNTH_ISE_PATH)/xtclsh run.tcl"'
else
		ssh $(USER)@$(SERVER) 'cd $(R_NAME)$(CWD) && $(HDLMAKE_RSYNTH_ISE_PATH)/xtclsh run.tcl'
endif


sync: 
		cd .. && rsync -av $(USER)@$(SERVER):$(R_NAME)/$(CWD) . && cd $(CWD)

#target for removing stuff from the remote location
cleanremote:
		ssh $(USER)@$(SERVER) 'rm -rf $(R_NAME)'

